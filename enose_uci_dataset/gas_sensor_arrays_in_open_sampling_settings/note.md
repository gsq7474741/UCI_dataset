# Gas sensor array under dynamic gas mixtures

## 数据集

### 数据集信息

实例数：从基于 72 个金属氧化物气体传感器阵列的化学检测平台记录的 18000 个时间序列测量值。

属性（特征）数量：每次测量包含 260 秒内记录的 72 个时间序列，每个时间序列的采样率为 100 Hz（每秒样本数）。

数据集还包含时间、温度和相对湿度信息。最终得到的数据集包括由26000 个点组成的 75 个时间序列。

该档案包含从组成我们传感平台的 72 个金属氧化物气体传感器阵列收集的 18000个时间序列测量记录，该平台用于在复杂环境条件下检测和识别潜在危险的化学气态物质。
我们的主要目的是让我们的数据集可以免费在线供化学传感研究和机器学习社区以及其他感兴趣的社区使用，以开发与开放采样环境中的气体传感鉴别任务（例如此处追求的）
和/或导航相关的替代竞争解决方案。该数据集仅可用于研究目的，严禁用于商业目的。

数据集收集于2010 年 12 月至 2012 年 4 月（16 个月），收集地点为加州大学圣地亚哥分校生物电路研究所的 2.5 米×1.2 米×0.4米风洞研究试验台。
具体来说，我们的定制研究设施配备了计算机监控的质量流量控制器为基础的连续流气体输送系统，以推进开式循环模式运行，
不断将外部湍流空气吸入风洞并排入风洞，然后将其排回外部，从而形成相对湍流较小的气流，向下游移动到试验场的末端，
这特别适合于需要注入化学毒剂或爆炸性混合物的应用，因为它可以防止饱和。

设计的风洞试验台设施由完全计算机化的环境操作（由在装有相应串行卡的PC 上使用 C++编程的播放器/舞台机器人服务器软件控制），并且只需极少的人工干预，
它具有多功能性，可以在整个实验过程中以高精度和高度可重复的方式以所需浓度释放感兴趣的化学物质，同时保持适当的环境条件以产生呈现湍流模式的化学气体羽流。
本研究中考虑的设计风洞试验台设施的图形说明以及问题的几何特征以及化学分析物源和化学传感平台的确切位置在下文引用的手稿图2 中显示。
所设计风洞的实际图片也显示在补充材料中，即随附手稿的图S.1。

由此产生的数据集引发了一个十类气体鉴别问题，包括十种不同的纯化学气体的记录，即丙酮、乙醛、氨、丁醇、乙烯、甲烷、甲醇、一氧化碳、苯和甲苯。
目标是识别和鉴别相关浓度的上述化学危害，而不管传感系统平台在注释的风洞研究设施内的位置以及环境中诱发的环境和参数条件如何。
有关化学分析物危害的身份及其在气体源出口处的标称浓度值（以体积百万分率 (ppmv) 为单位）的详细信息，请参阅 Vergara et a. 2013（以下手稿）中的表
1。

### 变量信息

传感器平台的响应以集成在传感器阵列中的 72 个气体传感器的活性敏感膜上的电阻形式读出；
因此，每次测量都会产生 72通道时间序列，每个时间序列由以每秒 100 个样本 (Hz) 的采样率收集的 260秒时间序列表示， 反映了评估场景中的所有环境变化。

有关时间序列处理的更详细分析和讨论以及它们的图形说明，请分别参阅下面手稿的第2 和第 3 节以及图 4。

为了便于操作，数据被组织成 11 个文件夹，每个文件夹包含每个化学类别标识和标称浓度的测量次数，如上所示，并在手稿的表2 中进行了描述。

例如，名为`Toluene_200`的文件夹表示气体标识的名称为甲苯，其剂量为 200 ppmv。每个文件夹包含 6 个文件夹，
每个文件夹代表风洞测试区域内的线路位置（位置 1，L1，到位置 6，L6，因为 L1 是距离气源最近的点），从这些位置记录时间序列集。
每个文件夹中有300 个文件，每个文件对应于在风洞中每个位置记录的测量次数。
每个文件的名称包含整个实验期间执行的每个测量的精确日志信息，其组织方式如下。
文件名的前12 位数字（例如，`201106060617`）表示收集每个特定测量的日期和时间，以年、月、日、时开头。
名称文件后面 19 个字符中的最后 4 位数字（例如`board_setPoint_500V`）表示固定工作温度值，由施加到化学传感器中嵌入式加热元件的电压值表示，
施加到整个传感平台，可采用 4 至 6 V 的标称值，分辨率值为 0.5 V。请注意，示例中的 500V 值是施加到传感器加热器的 5V 值的图形表示。

有关我们平台中使用的化学传感器的工作原理的更多详细信息，请参阅手稿的第2 部分。

文件名后面 16 个字符中的最后 3 位数字（例如`fan_setPoint_060`）表示用于在风洞中诱导不同人工气流速度的多步电机驱动排气扇的标称转速的设定点值。
在这种情况下，只采用了三个值：文件名中的值“000”，表示最慢的转速（1500rpm），值“060”，表示风扇的中间转速值（3900rpm），
值“100”，指风扇最快的感应速度，5500rpm。

以下27个字符的字符串的最后14个字符（例如，`mfc_setPoint_Toluene_200ppm`)描述了每个特定测量的分析物身份和浓度值。
因此，刚才提到的示例代表了与化学分析物身份“甲苯”相对应的类别，该类别的标称浓度值为200 ppm。
最后，名称中的最后 2 或 3 位数字（例如“p7”）描述了化学感应平台在风洞中所在的线点位置。
请注意，此位置的值有两个数字的偏移，即p7 值实际上代表了所引用手稿图 2 中所示的线位置 4。

例如，在`201106060617_board_setPoint_500V_fan_setPoint_060_mfc_setPoint_Toluene_200ppm_p7`中，整个文本行代表位于线路位置 L4
的化学感应平台的独立测量，该测量响应于 2011 年 6 月 6 日上午 6:17（太平洋标准时间）收集的 200 ppm 甲苯，加热器的工作电压为
5V，排气扇的标称转速为 3900 rpm。

***

在描述了生成的数据集中采用的命名配置后，我们描述了数据集每个附加文件中信息的组织。数据格式包含与每个测量文件相关的信息，包含上面指示的所有时间序列（9
个便携式模块 × 8 个传感器、温度和湿度值（分别为 oC 和 %，）、排气扇设定点和读数值、质量流量控制器设定点和实际读数值（%）以及读数时间（毫秒）），

组织如下： 
- Reading time (ms) 
- fan_set_point 
- fan_reading *
- mcf1_setpoint 
- mcf2_setpoint 
- mcf3_setpoint 
- mcf1_read 
- mcf2_read 
- mcf3_read 
- T 
- RH 
- 1 
- board1(8 chemical sensors) 
- 1 
- board2(8 chemical sensors) 
- 1 
- .... 
- 1 
- board9(8 chemical sensors)

**其中：“Reading time (ms)”是每次记录的时间步长（以毫秒为单位，采样率为 100 Hz），**

**“fan_set_point”和“fan_reading”分别是排气扇的设定点和实际读数，**

**“mcf1_setpoint”至“mcf3_setpoint”分别是实验过程中给予质量流量控制器1至3的开度设定值，**

**“mcf1_read”至“mcf1_read”分别是测量到的质量流量控制器1至3的开度，**

**“T”和“R”是整个实验过程中的温度和相对湿度值（单位分别为oC和%），**

**“board1（×8个化学传感器）”至“board9（×8个化学传感器）”分别是从每个位置的8个气体传感器（单位为KΩ）集成模块1至9收集的72个时间序列，**

**每个序列由数字“1”分隔，作为指示标签，从而形成72个时间序列化学传感器响应，这些响应被提取到分类器进行训练，如上所述在研究中。**

 ***

请注意，数据集中每列之间都有一个空格。因此，例如，在第1 行中：
```text
22250 0 0 100 100 100 103 103 105 22.22 63.43 1 476 555 803 497 775 885 873 843 1 346 545 635 616 571 552 773 745
1 397 50 9 660 638 755 744 745 657 1 420 510 525 531 504 650 719 715 1 2201 449 652 1228 847 654 850 737 1 370 459 650
445 756 773 847 803 1 345 457 587 554 757 704 769 818 1 354 407 499 696 786 686 757 733 1 339 418 547 567 653 573 773 84
```
数字“22250”代表在时间 22.25 秒时进行的录音，后面两个数字代表为风扇转速的设定点和测量值，后面的 6 个数字分别表示 MFC的设定点（本例中为 100）
和实际测量值（103、103、105），数字“22”。 22”和“63.43”代表特定时间记录的温度和湿度值，
而其余 80列列出了实际按照上述方式组织的每个测量记录的时间序列值，其中数字“1”表示每个传感器模块板之间的边界。
第一块和第九块板对应于靠近墙壁的位置，而板5 位于在与气体羽流正交的主线上。
有关每块板的确切位置，请参阅上述期刊文章的图 2。

*：我们发现每个文件上记录的排气扇实际读数值并不完全准确，某些测量记录显示“0”或其他随机值。请丢弃此信息值并仅使用设定点信息进行处理；该值是准确的。
最后，为了使相关文章中呈现的结果可重现对于本自述文件的用户，请使用手稿中描述的超参数值进行训练任务。
43”代表该特定时间记录的温度和湿度值，而其余80 列则列出了如上所述组织的每个测量记录的实际时间序列值，其中数字“1”表示每个传感器模块板之间的边界。
第一和第九块板对应于靠近墙壁的位置，而板5 位于与气体羽流正交的主线上。有关每块板的确切位置，请参阅所述期刊文章的图 2。 

### 数据样例

`WTD_upload/CO_1000/L1/201012100006_board_setPoint_400V_fan_setPoint_000_mfc_setPoint_CO_1000ppm_p1`:

```text
0	0	1575	0	0	0	0	0	0	25.53	40.86	1	425	371	599	407	800	899	814	780	1	230	386	503	536	636	613	926	870	1	355	380	559	733	1118	859	859	742	1	422	361	348	578	638	779	837	838	1	399	422	621	498	812	790	789	669	1	390	440	636	600	879	903	1007	906	1	357	427	577	527	1106	759	851	905	1	422	409	461	627	1128	1009	777	739	1	403	428	610	701	944	808	1058	1167	
10	0	1575	0	0	0	0	0	0	25.53	40.86	1	425	371	600	407	800	897	814	779	1	230	387	503	535	636	612	926	870	1	355	379	559	733	1118	859	859	742	1	422	362	348	578	638	779	837	838	1	399	422	620	497	813	790	790	670	1	390	441	636	600	880	903	1007	906	1	357	427	577	527	1105	759	851	905	1	422	409	461	627	1127	1009	777	739	1	403	428	610	702	944	808	1058	1167	
...
```

## 数据处理

### 提取metadata

prompt:

```text
修改当前文件，增加以下8列
name：board1-9，sensor0-7，共72列
description：board名字，sensor名字
data_type：int32
sensor：
Sensor, target gases
TGS2611 Methane
TGS2612 Methane, propane, butane
TGS2610 Propane
TGS2600 Hydrogen, carbon monoxide
TGS2602 Ammonia, H2S, VOC
TGS2602 Ammonia, H2S, VOC
TGS2620 Carbon monoxide, combustible gases, VOC
TGS2620 Carbon monoxide, combustible gases, VOC
unit：KOhm
trans_to_ohm_functor：lambda x: x*1000
column_sample_rate:100
```

### 时间序列SSL预训练任务

元数据：气体、浓度、采样率、电阻单位、每个样本时长

对于每个样本，处理为sqlite中的单个表：

每列的定义对应原数据的定义，即：
Reading time (ms),fan_set_point,fan_reading,mcf1_setpoint,mcf2_setpoint,mcf3_setpoint,mcf1_read,mcf2_read,mcf3_read,T,RH,board1_sensor0,...,board1_sensor7,...,board9_sensor0,...,board9_sensor7

对于整个数据库，增加一个表用于存储所有样本的元数据，包括表名称、气体、浓度、时间、电压、风扇设定点、mfc设定点、板位置

prompt:

```text
请帮我根据以上信息处理数据集，处理数据并插入到sqlite中，可以使用pandas和sqlalchemy。
当前目录结构如下：
.
└── .raw
    └── WTD_upload
        ├── Acetaldehyde_500
            └── L1
                ├── 201107250806_board_setPoint_400V_fan_setPoint_000_mfc_setPoint_Acetaldehyde_500ppm_p1
                └── ...
            ├── L2
            ├── L3
            ├── L4
            ├── L5
            └── L6
        ├── ...
        └── Toluene_200
            ├── L1
            ├── ...
            └── L6

78 directories



```

模型输出：

见 `process_data.py`

